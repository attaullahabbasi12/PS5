<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Attaullah Abbasi">
<meta name="dcterms.date" content="2024-11-09">

<title>PS5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="ps5_template (1)_files/libs/clipboard/clipboard.min.js"></script>
<script src="ps5_template (1)_files/libs/quarto-html/quarto.js"></script>
<script src="ps5_template (1)_files/libs/quarto-html/popper.min.js"></script>
<script src="ps5_template (1)_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ps5_template (1)_files/libs/quarto-html/anchor.min.js"></script>
<link href="ps5_template (1)_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ps5_template (1)_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ps5_template (1)_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ps5_template (1)_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ps5_template (1)_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">
\RecustomVerbatimEnvironment{verbatim}{Verbatim}{
  showspaces = false,
  showtabs = false,
  breaksymbolleft={},
  breaklines
}

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PS5</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Attaullah Abbasi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 9, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><strong>Due 11/9 at 5:00PM Central. Worth 100 points + 10 points extra credit.</strong></p>
<section id="submission-steps-10-pts" class="level2">
<h2 class="anchored" data-anchor-id="submission-steps-10-pts">Submission Steps (10 pts)</h2>
<ol type="1">
<li>This problem set is a paired problem set.</li>
<li>Play paper, scissors, rock to determine who goes first. Call that person - Attaullah Abbasi
<ul>
<li>Partner 1 (Attaullah Abbasi (attaullahabbasi))</li>
<li>Partner 2 : NA; completed Solo.</li>
</ul></li>
<li>Partner 1 will accept the <code>ps5</code> and then share the link it creates with their partner. You can only share it with one partner so you will not be able to change it after your partner has accepted.</li>
<li>“This submission is our work alone and complies with the 30538 integrity policy.” Add your initials to indicate your agreement: AA</li>
<li>“I have uploaded the names of anyone else other than my partner and I worked with on the problem set **<a href="https://docs.google.com/forms/d/185usrCREQaUbvAXpWhChkjghdGgmAZXA3lPWpXLLsts/edit">here</a> AA” (1 point)</li>
<li>Late coins used this pset: NA Late coins left after submission: 0:1</li>
<li>Knit your <code>ps5.qmd</code> to an PDF file to make <code>ps5.pdf</code>,
<ul>
<li>The PDF should not be more than 25 pages. Use <code>head()</code> and re-size figures when appropriate.</li>
</ul></li>
<li>(Partner 1): push <code>ps5.qmd</code> and <code>ps5.pdf</code> to your github repo.</li>
<li>(Partner 1): submit <code>ps5.pdf</code> via Gradescope. Add your partner on Gradescope.</li>
<li>(Partner 1): tag your submission in Gradescope</li>
</ol>
<div id="618b2e46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>alt.renderers.enable(<span class="st">"png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>RendererRegistry.enable('png')</code></pre>
</div>
</div>
</section>
<section id="step-1-develop-initial-scraper-and-crawler" class="level2">
<h2 class="anchored" data-anchor-id="step-1-develop-initial-scraper-and-crawler">Step 1: Develop initial scraper and crawler</h2>
<section id="scraping-partner-1" class="level3">
<h3 class="anchored" data-anchor-id="scraping-partner-1">1. Scraping (PARTNER 1)</h3>
<div id="7fc108e6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the URL to scrape</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://oig.hhs.gov/fraud/enforcement/"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the response status</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(response.content, <span class="st">'html.parser'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Finding all action items on the page</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    actions <span class="op">=</span> soup.find_all(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'usa-card card--list pep-card--minimal mobile:grid-col-12'</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Checking if actions list is empty</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> actions:</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No actions found. Check the class name in the code."</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(actions)<span class="sc">}</span><span class="ss"> actions."</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize lists for data storage</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    titles <span class="op">=</span> []</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> []</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> []</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    links <span class="op">=</span> []</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    agencies <span class="op">=</span> []</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Looping through each action and extracting data</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> action <span class="kw">in</span> actions:</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting the title</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        title_tag <span class="op">=</span> action.find(<span class="st">'h2'</span>, class_<span class="op">=</span><span class="st">'usa-card__heading'</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> title_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="st">"No Title Found"</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        titles.append(title)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting the date</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        date_tag <span class="op">=</span> action.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'font-body-sm margin-top-1'</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> date_tag.find(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'text-base-dark padding-right-105'</span>).get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="st">"No Date Found"</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        dates.append(date)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting the category</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        category_tag <span class="op">=</span> date_tag.find(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'display-inline-block usa-tag text-no-lowercase text-base-darkest bg-base-lightest margin-right-1'</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> category_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> category_tag <span class="cf">else</span> <span class="st">"No Category Found"</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        categories.append(category)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting the link and creating hyperlink HTML</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        link_tag <span class="op">=</span> title_tag.find(<span class="st">'a'</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        link <span class="op">=</span> <span class="ss">f"https://oig.hhs.gov</span><span class="sc">{</span>link_tag[<span class="st">'href'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> link_tag <span class="cf">else</span> <span class="st">"No Link Found"</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        links.append(<span class="ss">f'&lt;a href="</span><span class="sc">{</span>link<span class="sc">}</span><span class="ss">" target="_blank"&gt;Link&lt;/a&gt;'</span>)  <span class="co"># Create hyperlink</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Visit each link to get the agency information</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> link_tag:</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>            action_response <span class="op">=</span> requests.get(link)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> action_response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                action_soup <span class="op">=</span> BeautifulSoup(action_response.content, <span class="st">'html.parser'</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Locating the agency information in the "Action Details" section</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>                agency <span class="op">=</span> <span class="st">"Agency Info Not Found"</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                details_section <span class="op">=</span> action_soup.find(<span class="st">'ul'</span>, class_<span class="op">=</span><span class="st">'usa-list usa-list--unstyled margin-y-2'</span>)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> details_section:</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Search for 'Agency:' text in the list items</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                    list_items <span class="op">=</span> details_section.find_all(<span class="st">'li'</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> item <span class="kw">in</span> list_items:</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">'Agency:'</span> <span class="kw">in</span> item.get_text():</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                            agency <span class="op">=</span> item.get_text(strip<span class="op">=</span><span class="va">True</span>).split(<span class="st">"Agency:"</span>)[<span class="op">-</span><span class="dv">1</span>].strip()</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span>  <span class="co"># Exit after finding the agency</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>                agencies.append(agency)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>                <span class="co"># To be polite to the server, add a delay</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="dv">1</span>)  <span class="co"># 1-second delay</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>                agencies.append(<span class="st">"Failed to load page"</span>)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>            agencies.append(<span class="st">"No Link Found"</span>)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating a DataFrame</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Title'</span>: titles,</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Date'</span>: dates,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Category'</span>: categories,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Link'</span>: links,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Agency'</span>: agencies</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert DataFrame to HTML with custom CSS for Quarto</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    styled_html <span class="op">=</span> df.to_html(escape<span class="op">=</span><span class="va">False</span>, index<span class="op">=</span><span class="va">False</span>, border<span class="op">=</span><span class="dv">0</span>, classes<span class="op">=</span><span class="st">'table table-striped'</span>, justify<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adding CSS to ensure the table fits nicely in Quarto</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    custom_css <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;style&gt;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="st">        .table {</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 100%;</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="st">            table-layout: fixed;</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="st">        .table td, .table th {</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="st">            word-wrap: break-word;</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="st">            padding: 8px;</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="st">            vertical-align: top;</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/style&gt;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display styled HTML table with CSS in Jupyter or Quarto</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> display, HTML</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>    display(HTML(custom_css <span class="op">+</span> styled_html))</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed to retrieve data. Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 20 actions.</code></pre>
</div>
<div class="cell-output cell-output-display">

    
    
<table class="dataframe table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Link</th>
<th data-quarto-table-cell-role="th">Agency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pharmacist and Brother Convicted of $15M Medicare, Medicaid, and Private Insurer Fraud Scheme</td>
<td>November 8, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/pharmacist-and-brother-convicted-of-15m-medicare-medicaid-and-private-insurer-fraud-scheme/" target="_blank">Link</a></td>
<td>U.S. Department of Justice</td>
</tr>
<tr class="even">
<td>Boise Nurse Practitioner Sentenced To 48 Months For Conspiracy To Distribute Controlled Substances</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/boise-nurse-practitioner-sentenced-to-48-months-for-conspiracy-to-distribute-controlled-substances/" target="_blank">Link</a></td>
<td>November 7, 2024; U.S. Attorney's Office, District of Idaho</td>
</tr>
<tr class="odd">
<td>Former Traveling Nurse Pleads Guilty To Tampering With Morphine</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/former-traveling-nurse-pleads-guilty-to-tampering-with-morphine/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, District of Massachusetts</td>
</tr>
<tr class="even">
<td>Former Arlington Resident Sentenced To Prison For Disclosing Healthcare Records And Trying To Cover Up His Crimes</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/former-arlington-resident-sentenced-to-prison-for-disclosing-healthcare-records-and-trying-to-cover-up-his-crimes/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Virginia</td>
</tr>
<tr class="odd">
<td>Paroled Felon Sentenced To Six Years For Fraudulent Use Of Social Security Number And Theft Of Benefits</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/paroled-felon-sentenced-to-six-years-for-fraudulent-use-of-social-security-number-and-theft-of-benefits/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Middle District of Florida</td>
</tr>
<tr class="even">
<td>Former Licensed Counselor Sentenced For Defrauding Medicaid</td>
<td>November 6, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/former-licensed-counselor-sentenced-for-defrauding-medicaid/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Western District of Texas</td>
</tr>
<tr class="odd">
<td>Macomb County Doctor And Pharmacist Agree To Pay $700,948 To Settle False Claims Act Allegations</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/macomb-county-doctor-and-pharmacist-agree-to-pay-700948-to-settle-false-claims-act-allegations/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Michigan</td>
</tr>
<tr class="even">
<td>Rocky Hill Pharmacy And Its Owners Indicted For Conspiring To Submit False Pharmacy Claims, Making False Statements, And Aggravated Identity Theft</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/rocky-hill-pharmacy-and-its-owners-indicted-for-conspiring-to-submit-false-pharmacy-claims-making-false-statements-and-aggravated-identity-theft/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Tennessee</td>
</tr>
<tr class="odd">
<td>North Texas Medical Center Pays $14.2 Million To Resolve Potential False Claims Act Liability For Self-Reported Violations Of Medicare Regs, Stark Law</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/north-texas-medical-center-pays-142-million-to-resolve-potential-false-claims-act-liability-for-self-reported-violations-of-medicare-regs-stark-law/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Northern District of Texas</td>
</tr>
<tr class="even">
<td>New England Doctor Pleads Guilty To Drug Distribution Conspiracy</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/new-england-doctor-pleads-guilty-to-drug-distribution-conspiracy/" target="_blank">Link</a></td>
<td>U.S. Department of Justice</td>
</tr>
<tr class="odd">
<td>Attorney General Alan Wilson Announces Upstate Woman Charged With Stealing Thousands Of Dollars From Vulnerable Adult</td>
<td>November 4, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/attorney-general-alan-wilson-announces-upstate-woman-charged-with-stealing-thousands-of-dollars-from-vulnerable-adult/" target="_blank">Link</a></td>
<td>State of South Carolina</td>
</tr>
<tr class="even">
<td>St. Louis County Woman Accused Of $3 Million Home Health Care Fraud</td>
<td>November 1, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/st-louis-county-woman-accused-of-3-million-home-health-care-fraud/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Missouri</td>
</tr>
<tr class="odd">
<td>Lab Owner And Marketing Company Owner Both Found Guilty In Multi-Million Dollar Medicare And Medicaid Fraud Scheme</td>
<td>November 1, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/lab-owner-and-marketing-company-owner-both-found-guilty-in-multi-million-dollar-medicare-and-medicaid-fraud-scheme/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Middle District of Tennessee</td>
</tr>
<tr class="even">
<td>Compound Ingredient Supplier Medisca Inc., To Pay $21.75M To Resolve Allegations Of False And Inflated Average Wholesale Prices For Ingredients Used In Compounded Prescriptions</td>
<td>November 1, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/compound-ingredient-supplier-medisca-inc-to-pay-2175m-to-resolve-allegations-of-false-and-inflated-average-wholesale-prices-for-ingredients-used-in-compounded-prescriptions/" target="_blank">Link</a></td>
<td>U.S. Department of Justice</td>
</tr>
<tr class="odd">
<td>The New Mexico Department Of Justice Charges Former New Mexico State Police Officer With Medicaid Fraud, Identity Theft, And Practicing Medicine Without A License</td>
<td>November 1, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/the-new-mexico-department-of-justice-charges-former-new-mexico-state-police-officer-with-medicaid-fraud-identity-theft-and-practicing-medicine-without-a-license/" target="_blank">Link</a></td>
<td>State of New Mexico</td>
</tr>
<tr class="even">
<td>Nashville Woman Indicted, Charged In TBI Medicaid Patient Abuse Case</td>
<td>November 1, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/nashville-woman-indicted-charged-in-tbi-medicaid-patient-abuse-case/" target="_blank">Link</a></td>
<td>State of Tennessee</td>
</tr>
<tr class="odd">
<td>Michael DePalma, MD and Virginia I-Spine Physicians Agreed to Pay $153,000 for Allegedly Violating the Civil Monetary Penalties Law by Submitting Claims for Services that Exceeded the Allowable Number of Services</td>
<td>October 31, 2024</td>
<td>CMP and Affirmative Exclusions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/michael-depalma-md-and-virginia-i-spine-physicians-agreed-to-pay-153000-for-allegedly-violating-the-civil-monetary-penalties-law-by-submitting-claims-for-services-that-exceeded-the-allowable-number-of-services/" target="_blank">Link</a></td>
<td>Agency Info Not Found</td>
</tr>
<tr class="even">
<td>Columbus Doctor, His Clinic Convicted of $1.5 Million Medicaid Scheme</td>
<td>October 31, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/columbus-doctor-his-clinic-convicted-of-15-million-medicaid-scheme/" target="_blank">Link</a></td>
<td>Ohio</td>
</tr>
<tr class="odd">
<td>Mercy Health Youngstown Agreed to Pay $69,000 for Allegedly Violating the Civil Monetary Penalties Law by Contracting with an Excluded Individual</td>
<td>October 30, 2024</td>
<td>Fraud Self-Disclosures</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/mercy-health-youngstown-agreed-to-pay-69000-for-allegedly-violating-the-civil-monetary-penalties-law-by-contracting-with-an-excluded-individual/" target="_blank">Link</a></td>
<td>Agency Info Not Found</td>
</tr>
<tr class="even">
<td>Quincy-Based Physician Group To Pay $650,000 To Resolve Allegations Of False Billing To MassHealth</td>
<td>October 30, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/quincy-based-physician-group-to-pay-650000-to-resolve-allegations-of-false-billing-to-masshealth/" target="_blank">Link</a></td>
<td>State of Massachusetts</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="crawling-partner-1" class="level3">
<h3 class="anchored" data-anchor-id="crawling-partner-1">2. Crawling (PARTNER 1)</h3>
<div id="9c60b49d" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the URL to scrape</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://oig.hhs.gov/fraud/enforcement/"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(response.content, <span class="st">'html.parser'</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    actions <span class="op">=</span> soup.find_all(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'usa-card card--list pep-card--minimal mobile:grid-col-12'</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize lists for data storage</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    titles, dates, categories, links, agencies <span class="op">=</span> [], [], [], [], []</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> action <span class="kw">in</span> actions:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract title</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        title_tag <span class="op">=</span> action.find(<span class="st">'h2'</span>, class_<span class="op">=</span><span class="st">'usa-card__heading'</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> title_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="st">"No Title Found"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        titles.append(title)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract date</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        date_tag <span class="op">=</span> action.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'font-body-sm margin-top-1'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> date_tag.find(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'text-base-dark padding-right-105'</span>).get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="st">"No Date Found"</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        dates.append(date)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract category</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        category_tag <span class="op">=</span> date_tag.find(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'display-inline-block usa-tag text-no-lowercase text-base-darkest bg-base-lightest margin-right-1'</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        category <span class="op">=</span> category_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> category_tag <span class="cf">else</span> <span class="st">"No Category Found"</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        categories.append(category)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract link</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        link_tag <span class="op">=</span> title_tag.find(<span class="st">'a'</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        link <span class="op">=</span> <span class="ss">f"https://oig.hhs.gov</span><span class="sc">{</span>link_tag[<span class="st">'href'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> link_tag <span class="cf">else</span> <span class="st">"No Link Found"</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        links.append(<span class="ss">f'&lt;a href="</span><span class="sc">{</span>link<span class="sc">}</span><span class="ss">" target="_blank"&gt;Link&lt;/a&gt;'</span>)  <span class="co"># HTML link format</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Visit each link to get the agency information</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        agency <span class="op">=</span> <span class="st">"Agency Info Not Found"</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> link_tag:</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            action_response <span class="op">=</span> requests.get(link)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> action_response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                action_soup <span class="op">=</span> BeautifulSoup(action_response.content, <span class="st">'html.parser'</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                details_section <span class="op">=</span> action_soup.find(<span class="st">'ul'</span>, class_<span class="op">=</span><span class="st">'usa-list usa-list--unstyled margin-y-2'</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> details_section:</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> item <span class="kw">in</span> details_section.find_all(<span class="st">'li'</span>):</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">'Agency:'</span> <span class="kw">in</span> item.get_text():</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                            agency <span class="op">=</span> item.get_text(strip<span class="op">=</span><span class="va">True</span>).split(<span class="st">"Agency:"</span>)[<span class="op">-</span><span class="dv">1</span>].strip()</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        agencies.append(agency)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Title'</span>: titles,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Date'</span>: dates,</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Category'</span>: categories,</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Link'</span>: links,</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Agency'</span>: agencies</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert DataFrame to HTML with custom CSS</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    styled_html <span class="op">=</span> df.to_html(escape<span class="op">=</span><span class="va">False</span>, index<span class="op">=</span><span class="va">False</span>, border<span class="op">=</span><span class="dv">0</span>, classes<span class="op">=</span><span class="st">'table table-striped'</span>, justify<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add CSS for styling</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    custom_css <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;style&gt;</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="st">        .table {</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 100%;</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="st">            table-layout: fixed;</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="st">            font-size: 0.9em;</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="st">        .table td, .table th {</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="st">            word-wrap: break-word;</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="st">            padding: 8px;</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="st">            vertical-align: top;</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="st">        .table th {</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="st">            background-color: #f2f2f2;</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="st">            text-align: center;</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/style&gt;</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display styled HTML table with CSS in Jupyter or Quarto</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> display, HTML</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    display(HTML(custom_css <span class="op">+</span> styled_html))</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed to retrieve data. Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

    
    
<table class="dataframe table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Title</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Link</th>
<th data-quarto-table-cell-role="th">Agency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pharmacist and Brother Convicted of $15M Medicare, Medicaid, and Private Insurer Fraud Scheme</td>
<td>November 8, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/pharmacist-and-brother-convicted-of-15m-medicare-medicaid-and-private-insurer-fraud-scheme/" target="_blank">Link</a></td>
<td>U.S. Department of Justice</td>
</tr>
<tr class="even">
<td>Boise Nurse Practitioner Sentenced To 48 Months For Conspiracy To Distribute Controlled Substances</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/boise-nurse-practitioner-sentenced-to-48-months-for-conspiracy-to-distribute-controlled-substances/" target="_blank">Link</a></td>
<td>November 7, 2024; U.S. Attorney's Office, District of Idaho</td>
</tr>
<tr class="odd">
<td>Former Traveling Nurse Pleads Guilty To Tampering With Morphine</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/former-traveling-nurse-pleads-guilty-to-tampering-with-morphine/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, District of Massachusetts</td>
</tr>
<tr class="even">
<td>Former Arlington Resident Sentenced To Prison For Disclosing Healthcare Records And Trying To Cover Up His Crimes</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/former-arlington-resident-sentenced-to-prison-for-disclosing-healthcare-records-and-trying-to-cover-up-his-crimes/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Virginia</td>
</tr>
<tr class="odd">
<td>Paroled Felon Sentenced To Six Years For Fraudulent Use Of Social Security Number And Theft Of Benefits</td>
<td>November 7, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/paroled-felon-sentenced-to-six-years-for-fraudulent-use-of-social-security-number-and-theft-of-benefits/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Middle District of Florida</td>
</tr>
<tr class="even">
<td>Former Licensed Counselor Sentenced For Defrauding Medicaid</td>
<td>November 6, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/former-licensed-counselor-sentenced-for-defrauding-medicaid/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Western District of Texas</td>
</tr>
<tr class="odd">
<td>Macomb County Doctor And Pharmacist Agree To Pay $700,948 To Settle False Claims Act Allegations</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/macomb-county-doctor-and-pharmacist-agree-to-pay-700948-to-settle-false-claims-act-allegations/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Michigan</td>
</tr>
<tr class="even">
<td>Rocky Hill Pharmacy And Its Owners Indicted For Conspiring To Submit False Pharmacy Claims, Making False Statements, And Aggravated Identity Theft</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/rocky-hill-pharmacy-and-its-owners-indicted-for-conspiring-to-submit-false-pharmacy-claims-making-false-statements-and-aggravated-identity-theft/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Tennessee</td>
</tr>
<tr class="odd">
<td>North Texas Medical Center Pays $14.2 Million To Resolve Potential False Claims Act Liability For Self-Reported Violations Of Medicare Regs, Stark Law</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/north-texas-medical-center-pays-142-million-to-resolve-potential-false-claims-act-liability-for-self-reported-violations-of-medicare-regs-stark-law/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Northern District of Texas</td>
</tr>
<tr class="even">
<td>New England Doctor Pleads Guilty To Drug Distribution Conspiracy</td>
<td>November 4, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/new-england-doctor-pleads-guilty-to-drug-distribution-conspiracy/" target="_blank">Link</a></td>
<td>U.S. Department of Justice</td>
</tr>
<tr class="odd">
<td>Attorney General Alan Wilson Announces Upstate Woman Charged With Stealing Thousands Of Dollars From Vulnerable Adult</td>
<td>November 4, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/attorney-general-alan-wilson-announces-upstate-woman-charged-with-stealing-thousands-of-dollars-from-vulnerable-adult/" target="_blank">Link</a></td>
<td>State of South Carolina</td>
</tr>
<tr class="even">
<td>St. Louis County Woman Accused Of $3 Million Home Health Care Fraud</td>
<td>November 1, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/st-louis-county-woman-accused-of-3-million-home-health-care-fraud/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Eastern District of Missouri</td>
</tr>
<tr class="odd">
<td>Lab Owner And Marketing Company Owner Both Found Guilty In Multi-Million Dollar Medicare And Medicaid Fraud Scheme</td>
<td>November 1, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/lab-owner-and-marketing-company-owner-both-found-guilty-in-multi-million-dollar-medicare-and-medicaid-fraud-scheme/" target="_blank">Link</a></td>
<td>U.S. Attorney's Office, Middle District of Tennessee</td>
</tr>
<tr class="even">
<td>Compound Ingredient Supplier Medisca Inc., To Pay $21.75M To Resolve Allegations Of False And Inflated Average Wholesale Prices For Ingredients Used In Compounded Prescriptions</td>
<td>November 1, 2024</td>
<td>Criminal and Civil Actions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/compound-ingredient-supplier-medisca-inc-to-pay-2175m-to-resolve-allegations-of-false-and-inflated-average-wholesale-prices-for-ingredients-used-in-compounded-prescriptions/" target="_blank">Link</a></td>
<td>U.S. Department of Justice</td>
</tr>
<tr class="odd">
<td>The New Mexico Department Of Justice Charges Former New Mexico State Police Officer With Medicaid Fraud, Identity Theft, And Practicing Medicine Without A License</td>
<td>November 1, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/the-new-mexico-department-of-justice-charges-former-new-mexico-state-police-officer-with-medicaid-fraud-identity-theft-and-practicing-medicine-without-a-license/" target="_blank">Link</a></td>
<td>State of New Mexico</td>
</tr>
<tr class="even">
<td>Nashville Woman Indicted, Charged In TBI Medicaid Patient Abuse Case</td>
<td>November 1, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/nashville-woman-indicted-charged-in-tbi-medicaid-patient-abuse-case/" target="_blank">Link</a></td>
<td>State of Tennessee</td>
</tr>
<tr class="odd">
<td>Michael DePalma, MD and Virginia I-Spine Physicians Agreed to Pay $153,000 for Allegedly Violating the Civil Monetary Penalties Law by Submitting Claims for Services that Exceeded the Allowable Number of Services</td>
<td>October 31, 2024</td>
<td>CMP and Affirmative Exclusions</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/michael-depalma-md-and-virginia-i-spine-physicians-agreed-to-pay-153000-for-allegedly-violating-the-civil-monetary-penalties-law-by-submitting-claims-for-services-that-exceeded-the-allowable-number-of-services/" target="_blank">Link</a></td>
<td>Agency Info Not Found</td>
</tr>
<tr class="even">
<td>Columbus Doctor, His Clinic Convicted of $1.5 Million Medicaid Scheme</td>
<td>October 31, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/columbus-doctor-his-clinic-convicted-of-15-million-medicaid-scheme/" target="_blank">Link</a></td>
<td>Ohio</td>
</tr>
<tr class="odd">
<td>Mercy Health Youngstown Agreed to Pay $69,000 for Allegedly Violating the Civil Monetary Penalties Law by Contracting with an Excluded Individual</td>
<td>October 30, 2024</td>
<td>Fraud Self-Disclosures</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/mercy-health-youngstown-agreed-to-pay-69000-for-allegedly-violating-the-civil-monetary-penalties-law-by-contracting-with-an-excluded-individual/" target="_blank">Link</a></td>
<td>Agency Info Not Found</td>
</tr>
<tr class="even">
<td>Quincy-Based Physician Group To Pay $650,000 To Resolve Allegations Of False Billing To MassHealth</td>
<td>October 30, 2024</td>
<td>State Enforcement Agencies</td>
<td><a href="https://oig.hhs.gov/fraud/enforcement/quincy-based-physician-group-to-pay-650000-to-resolve-allegations-of-false-billing-to-masshealth/" target="_blank">Link</a></td>
<td>State of Massachusetts</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="step-2-making-the-scraper-dynamic" class="level2">
<h2 class="anchored" data-anchor-id="step-2-making-the-scraper-dynamic">Step 2: Making the scraper dynamic</h2>
<section id="turning-the-scraper-into-a-function" class="level3">
<h3 class="anchored" data-anchor-id="turning-the-scraper-into-a-function">1. Turning the scraper into a function</h3>
<ul>
<li><ol type="a">
<li>Pseudo-Code (PARTNER 2)</li>
</ol></li>
</ul>
</section>
</section>
<section id="pseudo-code-for-scrape_enforcement_actionsmonth-year" class="level2">
<h2 class="anchored" data-anchor-id="pseudo-code-for-scrape_enforcement_actionsmonth-year">Pseudo-Code for <code>scrape_enforcement_actions(month, year)</code></h2>
<ol type="1">
<li><strong>Input Validation</strong>:
<ul>
<li>Check if <code>year &gt;= 2013</code>. If <code>year &lt; 2013</code>, print a message to the user: <code>"Please provide a year &gt;= 2013 as only enforcement actions after 2013 are available."</code></li>
<li>If the year is valid, proceed to the next step.</li>
</ul></li>
<li><strong>Setup Variables</strong>:
<ul>
<li>Define the base URL for the enforcement actions page.</li>
<li>Create an empty list to store the extracted data for each action (title, date, category, link, and agency).</li>
</ul></li>
<li><strong>Loop through the Pages</strong>:
<ul>
<li>While the current date is on or after the specified start month and year:
<ul>
<li>Construct the URL dynamically to include the page number (if applicable).</li>
<li>Send a request to the server and parse the page with BeautifulSoup.</li>
<li>Wait for 1 second between requests to avoid server-side blocking.</li>
<li>If the page contains enforcement actions:
<ul>
<li>For each action item:
<ul>
<li>Extract the <strong>title</strong>.</li>
<li>Extract the <strong>date</strong>. Stop if the date is earlier than the specified <code>month</code> and <code>year</code>.</li>
<li>Extract the <strong>category</strong>.</li>
<li>Extract the <strong>link</strong> and visit it to get the <strong>agency</strong>.</li>
<li>Append the data (title, date, category, link, and agency) to the list.</li>
</ul></li>
</ul></li>
<li>If the page has no more actions (or there’s a date cutoff), break the loop.</li>
</ul></li>
</ul></li>
<li><strong>Create and Save the DataFrame</strong>:
<ul>
<li>Convert the list of data to a pandas DataFrame.</li>
<li>Save the DataFrame as a CSV file named <code>enforcement_actions_&lt;year&gt;_&lt;month&gt;.csv</code>.</li>
</ul></li>
<li><strong>Return</strong> the DataFrame or a confirmation message.</li>
</ol>
<section id="discussion-of-loops" class="level3">
<h3 class="anchored" data-anchor-id="discussion-of-loops">Discussion of Loops</h3>
<ul>
<li><strong>While Loop</strong>: The function will use a <code>while</code> loop to continue scraping pages until:
<ul>
<li>The date in the scraped data goes beyond the current date.</li>
<li>The dates in the enforcement actions are before the start date specified (to stop scraping earlier records).</li>
</ul></li>
<li><strong>For Loop</strong>: Inside each page, a <code>for</code> loop will iterate over the enforcement actions listed, extracting data for each item.</li>
</ul>
<p>This structure ensures that we dynamically scrape data starting from the user-specified date and save it in the specified format, all while respecting server limitations with a 1-second delay between requests.</p>
<ul>
<li><ol start="2" type="a">
<li>Create Dynamic Scraper (PARTNER 2)</li>
</ol></li>
</ul>
<div id="e059edb4" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> aiohttp</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> fetch_agency(link, session):</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    agency <span class="op">=</span> <span class="st">"Not Available"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="cf">with</span> session.get(link) <span class="im">as</span> response:</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> response.status <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                page_content <span class="op">=</span> <span class="cf">await</span> response.text()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                action_soup <span class="op">=</span> BeautifulSoup(page_content, <span class="st">'html.parser'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                details_section <span class="op">=</span> action_soup.find(<span class="st">'ul'</span>, class_<span class="op">=</span><span class="st">'usa-list usa-list--unstyled margin-y-2'</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> details_section:</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                    list_items <span class="op">=</span> details_section.find_all(<span class="st">'li'</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> item <span class="kw">in</span> list_items:</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">'Agency:'</span> <span class="kw">in</span> item.get_text():</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                            agency <span class="op">=</span> item.get_text(strip<span class="op">=</span><span class="va">True</span>).split(<span class="st">"Agency:"</span>)[<span class="op">-</span><span class="dv">1</span>].strip()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Failed to fetch agency for link: </span><span class="sc">{</span>link<span class="sc">}</span><span class="ss">. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agency</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> scrape_enforcement_actions(start_year, start_month, fetch_agency_details<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check the input year</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> start_year <span class="op">&lt;</span> <span class="dv">2013</span>:</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Please enter a year &gt;= 2013, as only enforcement actions after 2013 are listed."</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base URL</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    base_url <span class="op">=</span> <span class="st">"https://oig.hhs.gov/fraud/enforcement/"</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize lists to store data</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    titles, dates, categories, links, agencies <span class="op">=</span> [], [], [], [], []</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    page <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    all_data_scraped <span class="op">=</span> <span class="va">False</span>  <span class="co"># Flag to indicate if scraping is complete</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an aiohttp session if fetching agency details</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">with</span> aiohttp.ClientSession() <span class="im">as</span> session:</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Iterate through pages until reaching the target start date or end of pages</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> all_data_scraped:</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Construct the URL for each page</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">?page=</span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> session.get(url) <span class="im">as</span> response:</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> response.status <span class="op">!=</span> <span class="dv">200</span>:</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to retrieve page </span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">. Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Parse the page content</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                page_content <span class="op">=</span> <span class="cf">await</span> response.text()</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                soup <span class="op">=</span> BeautifulSoup(page_content, <span class="st">'html.parser'</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find all action items on the page</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                actions <span class="op">=</span> soup.find_all(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'usa-card card--list pep-card--minimal mobile:grid-col-12'</span>)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> actions:</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"No more actions found. Ending scraping at page </span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> action <span class="kw">in</span> actions:</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract title</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                    title_tag <span class="op">=</span> action.find(<span class="st">'h2'</span>, class_<span class="op">=</span><span class="st">'usa-card__heading'</span>)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                    title <span class="op">=</span> title_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="st">"No Title Found"</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                    titles.append(title)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract date</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>                    date_tag <span class="op">=</span> action.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'font-body-sm margin-top-1'</span>)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>                    date <span class="op">=</span> date_tag.find(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'text-base-dark padding-right-105'</span>).get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="st">"No Date Found"</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>                    dates.append(date)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Check if the date is within the desired range (Jan 2023 onwards)</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>                    date_obj <span class="op">=</span> pd.to_datetime(date, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> date_obj <span class="kw">and</span> (date_obj <span class="op">&lt;</span> pd.Timestamp(<span class="ss">f"</span><span class="sc">{</span>start_year<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>start_month<span class="sc">}</span><span class="ss">-01"</span>)):</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>                        all_data_scraped <span class="op">=</span> <span class="va">True</span>  <span class="co"># Stop further scraping if date is too old</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract category</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>                    category_tag <span class="op">=</span> date_tag.find(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'display-inline-block usa-tag text-no-lowercase text-base-darkest bg-base-lightest margin-right-1'</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>                    category <span class="op">=</span> category_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> category_tag <span class="cf">else</span> <span class="st">"No Category Found"</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                    categories.append(category)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract link</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                    link_tag <span class="op">=</span> title_tag.find(<span class="st">'a'</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>                    link <span class="op">=</span> <span class="ss">f"https://oig.hhs.gov</span><span class="sc">{</span>link_tag[<span class="st">'href'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> link_tag <span class="cf">else</span> <span class="st">"No Link Found"</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>                    links.append(link)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Append agency info if needed, or add placeholder</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> fetch_agency_details <span class="kw">and</span> link_tag:</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>                        agency <span class="op">=</span> <span class="cf">await</span> fetch_agency(link, session)</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>                        agency <span class="op">=</span> <span class="st">"Not Retrieved"</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>                    agencies.append(agency)</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Increment the page counter and add a delay for the next request</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>                page <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>                <span class="cf">await</span> asyncio.sleep(<span class="dv">1</span>)  <span class="co"># Wait between pages</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if all lists are of the same length, else print error message</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    min_len <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(titles), <span class="bu">len</span>(dates), <span class="bu">len</span>(categories), <span class="bu">len</span>(links), <span class="bu">len</span>(agencies))</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>    titles, dates, categories, links, agencies <span class="op">=</span> titles[:min_len], dates[:min_len], categories[:min_len], links[:min_len], agencies[:min_len]</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create DataFrame</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Title'</span>: titles,</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Date'</span>: dates,</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Category'</span>: categories,</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Link'</span>: links,</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Agency'</span>: agencies</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save DataFrame to CSV</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> <span class="ss">f"enforcement_actions_</span><span class="sc">{</span>start_year<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>start_month<span class="sc">}</span><span class="ss">.csv"</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>    df.to_csv(filename, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Data saved to </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display summary of results</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Total enforcement actions scraped: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>        earliest_action <span class="op">=</span> df.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Earliest Enforcement Action:"</span>)</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Title: </span><span class="sc">{</span>earliest_action[<span class="st">'Title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Date: </span><span class="sc">{</span>earliest_action[<span class="st">'Date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Category: </span><span class="sc">{</span>earliest_action[<span class="st">'Category'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Link: </span><span class="sc">{</span>earliest_action[<span class="st">'Link'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Agency: </span><span class="sc">{</span>earliest_action[<span class="st">'Agency'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage in a Jupyter Notebook or interactive environment:</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> scrape_enforcement_actions(<span class="dv">2023</span>, <span class="dv">1</span>, fetch_agency_details<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><ol start="3" type="a">
<li>Test Partner’s Code (PARTNER 1)</li>
</ol></li>
</ul>
<div id="0291bdec" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> aiohttp</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Async function to fetch agency details</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> fetch_agency(link, session):</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    agency <span class="op">=</span> <span class="st">"Not Available"</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="cf">with</span> session.get(link) <span class="im">as</span> response:</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> response.status <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                page_content <span class="op">=</span> <span class="cf">await</span> response.text()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                action_soup <span class="op">=</span> BeautifulSoup(page_content, <span class="st">'html.parser'</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                details_section <span class="op">=</span> action_soup.find(<span class="st">'ul'</span>, class_<span class="op">=</span><span class="st">'usa-list usa-list--unstyled margin-y-2'</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> details_section:</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                    list_items <span class="op">=</span> details_section.find_all(<span class="st">'li'</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> item <span class="kw">in</span> list_items:</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">'Agency:'</span> <span class="kw">in</span> item.get_text():</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                            agency <span class="op">=</span> item.get_text(strip<span class="op">=</span><span class="va">True</span>).split(<span class="st">"Agency:"</span>)[<span class="op">-</span><span class="dv">1</span>].strip()</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Failed to fetch agency for link: </span><span class="sc">{</span>link<span class="sc">}</span><span class="ss">. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agency</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Main async function to scrape enforcement actions</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> scrape_enforcement_actions(start_year, start_month, fetch_agency_details<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate year input</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> start_year <span class="op">&lt;</span> <span class="dv">2013</span>:</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Please enter a year &gt;= 2013, as only enforcement actions after 2013 are listed."</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base URL</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    base_url <span class="op">=</span> <span class="st">"https://oig.hhs.gov/fraud/enforcement/"</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize lists to store data</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    titles, dates, categories, links, agencies <span class="op">=</span> [], [], [], [], []</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    page <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    all_data_scraped <span class="op">=</span> <span class="va">False</span>  <span class="co"># Flag to indicate if scraping is complete</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an aiohttp session</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">with</span> aiohttp.ClientSession() <span class="im">as</span> session:</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> all_data_scraped:</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Construct URL for the page</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">?page=</span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> session.get(url) <span class="im">as</span> response:</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> response.status <span class="op">!=</span> <span class="dv">200</span>:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Failed to retrieve page </span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">. Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Parse the page content</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>                page_content <span class="op">=</span> <span class="cf">await</span> response.text()</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>                soup <span class="op">=</span> BeautifulSoup(page_content, <span class="st">'html.parser'</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find all action items on the page</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>                actions <span class="op">=</span> soup.find_all(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'usa-card card--list pep-card--minimal mobile:grid-col-12'</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> actions:</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"No more actions found. Ending scraping at page </span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> action <span class="kw">in</span> actions:</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract title</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>                    title_tag <span class="op">=</span> action.find(<span class="st">'h2'</span>, class_<span class="op">=</span><span class="st">'usa-card__heading'</span>)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>                    title <span class="op">=</span> title_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="st">"No Title Found"</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>                    titles.append(title)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract date</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>                    date_tag <span class="op">=</span> action.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'font-body-sm margin-top-1'</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>                    date <span class="op">=</span> date_tag.find(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'text-base-dark padding-right-105'</span>).get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="st">"No Date Found"</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>                    dates.append(date)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Check if date is within desired range</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>                    date_obj <span class="op">=</span> pd.to_datetime(date, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> date_obj <span class="kw">and</span> (date_obj <span class="op">&lt;</span> pd.Timestamp(<span class="ss">f"</span><span class="sc">{</span>start_year<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>start_month<span class="sc">}</span><span class="ss">-01"</span>)):</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>                        all_data_scraped <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract category</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>                    category_tag <span class="op">=</span> date_tag.find(<span class="st">'li'</span>, class_<span class="op">=</span><span class="st">'display-inline-block usa-tag text-no-lowercase text-base-darkest bg-base-lightest margin-right-1'</span>) <span class="cf">if</span> date_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>                    category <span class="op">=</span> category_tag.get_text(strip<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> category_tag <span class="cf">else</span> <span class="st">"No Category Found"</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>                    categories.append(category)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Extract link</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>                    link_tag <span class="op">=</span> title_tag.find(<span class="st">'a'</span>) <span class="cf">if</span> title_tag <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>                    link <span class="op">=</span> <span class="ss">f"https://oig.hhs.gov</span><span class="sc">{</span>link_tag[<span class="st">'href'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> link_tag <span class="cf">else</span> <span class="st">"No Link Found"</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>                    links.append(link)</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Fetch agency info if needed</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> fetch_agency_details <span class="kw">and</span> link_tag:</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>                        agency <span class="op">=</span> <span class="cf">await</span> fetch_agency(link, session)</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>                        agency <span class="op">=</span> <span class="st">"Not Retrieved"</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>                    agencies.append(agency)</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Increment the page counter and add a delay for the next request</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>                page <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>                <span class="cf">await</span> asyncio.sleep(<span class="dv">1</span>)  <span class="co"># Wait between pages</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure all lists are of equal length</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    min_len <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(titles), <span class="bu">len</span>(dates), <span class="bu">len</span>(categories), <span class="bu">len</span>(links), <span class="bu">len</span>(agencies))</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    titles, dates, categories, links, agencies <span class="op">=</span> titles[:min_len], dates[:min_len], categories[:min_len], links[:min_len], agencies[:min_len]</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create DataFrame</span></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Title'</span>: titles,</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Date'</span>: dates,</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Category'</span>: categories,</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Link'</span>: links,</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Agency'</span>: agencies</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save DataFrame to CSV</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> <span class="ss">f"enforcement_actions_</span><span class="sc">{</span>start_year<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>start_month<span class="sc">}</span><span class="ss">.csv"</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    df.to_csv(filename, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Data saved to </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display summary of results</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Total enforcement actions scraped: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>        earliest_action <span class="op">=</span> df.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Earliest Enforcement Action:"</span>)</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Title: </span><span class="sc">{</span>earliest_action[<span class="st">'Title'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Date: </span><span class="sc">{</span>earliest_action[<span class="st">'Date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Category: </span><span class="sc">{</span>earliest_action[<span class="st">'Category'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Link: </span><span class="sc">{</span>earliest_action[<span class="st">'Link'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Agency: </span><span class="sc">{</span>earliest_action[<span class="st">'Agency'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage (to be run in a Jupyter Notebook or async-compatible environment):</span></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> scrape_enforcement_actions(<span class="dv">2023</span>, <span class="dv">1</span>, fetch_agency_details<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-3-plot-data-based-on-scraped-data" class="level2">
<h2 class="anchored" data-anchor-id="step-3-plot-data-based-on-scraped-data">Step 3: Plot data based on scraped data</h2>
<section id="plot-the-number-of-enforcement-actions-over-time-partner-2" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-number-of-enforcement-actions-over-time-partner-2">1. Plot the number of enforcement actions over time (PARTNER 2)</h3>
<div id="176ece5f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data from the CSV file</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"/Users/attaullah/Documents/PS5/enforcement_actions_2023_1_cleaned.csv"</span>)  <span class="co"># Update the file path as needed</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'Date' column to datetime format, handling any errors</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with invalid dates</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'Date'</span>])</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year and month, then count the number of actions per month</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'YearMonth'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.to_period(<span class="st">'M'</span>)  <span class="co"># Use 'M' for monthly grouping</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>monthly_counts <span class="op">=</span> df.groupby(<span class="st">'YearMonth'</span>).size().reset_index(name<span class="op">=</span><span class="st">'Enforcement_Actions'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert YearMonth back to datetime for proper plotting in Altair</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>monthly_counts[<span class="st">'YearMonth'</span>] <span class="op">=</span> monthly_counts[<span class="st">'YearMonth'</span>].dt.to_timestamp()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a line chart using Altair</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>line_chart <span class="op">=</span> alt.Chart(monthly_counts).mark_line().encode(</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'YearMonth:T'</span>, title<span class="op">=</span><span class="st">'Date (Year-Month)'</span>),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Enforcement_Actions:Q'</span>, title<span class="op">=</span><span class="st">'Number of Enforcement Actions'</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Enforcement Actions Over Time (Monthly Aggregation)'</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">400</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable default renderer (useful in Jupyter Notebooks)</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>alt.renderers.enable(<span class="st">"default"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the chart</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>line_chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<style>
  #altair-viz-06afa5b0fc284d5ba11db57f496947f2.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-06afa5b0fc284d5ba11db57f496947f2.vega-embed details,
  #altair-viz-06afa5b0fc284d5ba11db57f496947f2.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-06afa5b0fc284d5ba11db57f496947f2"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-06afa5b0fc284d5ba11db57f496947f2") {
      outputDiv = document.getElementById("altair-viz-06afa5b0fc284d5ba11db57f496947f2");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-e4eb09511b3d730b94e7c43077a08a2c"}, "mark": {"type": "line"}, "encoding": {"x": {"field": "YearMonth", "title": "Date (Year-Month)", "type": "temporal"}, "y": {"field": "Enforcement_Actions", "title": "Number of Enforcement Actions", "type": "quantitative"}}, "height": 400, "title": "Number of Enforcement Actions Over Time (Monthly Aggregation)", "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-e4eb09511b3d730b94e7c43077a08a2c": [{"YearMonth": "2023-01-01T00:00:00", "Enforcement_Actions": 56}, {"YearMonth": "2023-02-01T00:00:00", "Enforcement_Actions": 64}, {"YearMonth": "2023-03-01T00:00:00", "Enforcement_Actions": 77}, {"YearMonth": "2023-04-01T00:00:00", "Enforcement_Actions": 77}, {"YearMonth": "2023-05-01T00:00:00", "Enforcement_Actions": 80}, {"YearMonth": "2023-06-01T00:00:00", "Enforcement_Actions": 89}, {"YearMonth": "2023-07-01T00:00:00", "Enforcement_Actions": 52}, {"YearMonth": "2023-08-01T00:00:00", "Enforcement_Actions": 81}, {"YearMonth": "2023-09-01T00:00:00", "Enforcement_Actions": 69}, {"YearMonth": "2023-10-01T00:00:00", "Enforcement_Actions": 72}, {"YearMonth": "2023-11-01T00:00:00", "Enforcement_Actions": 60}, {"YearMonth": "2023-12-01T00:00:00", "Enforcement_Actions": 64}, {"YearMonth": "2024-01-01T00:00:00", "Enforcement_Actions": 62}, {"YearMonth": "2024-02-01T00:00:00", "Enforcement_Actions": 58}, {"YearMonth": "2024-03-01T00:00:00", "Enforcement_Actions": 61}, {"YearMonth": "2024-04-01T00:00:00", "Enforcement_Actions": 59}, {"YearMonth": "2024-05-01T00:00:00", "Enforcement_Actions": 76}, {"YearMonth": "2024-06-01T00:00:00", "Enforcement_Actions": 83}, {"YearMonth": "2024-07-01T00:00:00", "Enforcement_Actions": 69}, {"YearMonth": "2024-08-01T00:00:00", "Enforcement_Actions": 56}, {"YearMonth": "2024-09-01T00:00:00", "Enforcement_Actions": 71}, {"YearMonth": "2024-10-01T00:00:00", "Enforcement_Actions": 82}, {"YearMonth": "2024-11-01T00:00:00", "Enforcement_Actions": 16}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="plot-the-number-of-enforcement-actions-categorized-partner-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-number-of-enforcement-actions-categorized-partner-1">2. Plot the number of enforcement actions categorized: (PARTNER 1)</h3>
<ul>
<li>based on “Criminal and Civil Actions” vs.&nbsp;“State Enforcement Agencies”</li>
</ul>
<div id="273ae3b7" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"enforcement_actions_2021_1.csv"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'Date' to datetime and drop rows with invalid dates</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'Date'</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for "Criminal and Civil Actions" and "State Enforcement Agencies" categories</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df[df[<span class="st">'Category'</span>].isin([<span class="st">'Criminal and Civil Actions'</span>, <span class="st">'State Enforcement Agencies'</span>])]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year and month, and count the number of actions for each category</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>df_filtered[<span class="st">'YearMonth'</span>] <span class="op">=</span> df_filtered[<span class="st">'Date'</span>].dt.to_period(<span class="st">'M'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>monthly_counts <span class="op">=</span> df_filtered.groupby([<span class="st">'YearMonth'</span>, <span class="st">'Category'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'Enforcement_Actions'</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert YearMonth back to datetime for plotting</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>monthly_counts[<span class="st">'YearMonth'</span>] <span class="op">=</span> pd.to_datetime(monthly_counts[<span class="st">'YearMonth'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data using Altair</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>line_chart <span class="op">=</span> alt.Chart(monthly_counts).mark_line().encode(</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'YearMonth:T'</span>, title<span class="op">=</span><span class="st">'Date (Year-Month)'</span>),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Enforcement_Actions:Q'</span>, title<span class="op">=</span><span class="st">'Number of Enforcement Actions'</span>),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>alt.Color(<span class="st">'Category:N'</span>, title<span class="op">=</span><span class="st">'Category'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Enforcement Actions Over Time by Category'</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">400</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>line_chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-32627c05c95248588d055685fe32b511.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-32627c05c95248588d055685fe32b511.vega-embed details,
  #altair-viz-32627c05c95248588d055685fe32b511.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-32627c05c95248588d055685fe32b511"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-32627c05c95248588d055685fe32b511") {
      outputDiv = document.getElementById("altair-viz-32627c05c95248588d055685fe32b511");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-1cb7df827b6b26763e9ed07d6dbcdba4"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "Category", "title": "Category", "type": "nominal"}, "x": {"field": "YearMonth", "title": "Date (Year-Month)", "type": "temporal"}, "y": {"field": "Enforcement_Actions", "title": "Number of Enforcement Actions", "type": "quantitative"}}, "height": 400, "title": "Enforcement Actions Over Time by Category", "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-1cb7df827b6b26763e9ed07d6dbcdba4": [{"YearMonth": "2021-01-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 22}, {"YearMonth": "2021-01-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 12}, {"YearMonth": "2021-02-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 34}, {"YearMonth": "2021-02-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 11}, {"YearMonth": "2021-03-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 35}, {"YearMonth": "2021-03-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 10}, {"YearMonth": "2021-04-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 34}, {"YearMonth": "2021-04-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 17}, {"YearMonth": "2021-05-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 35}, {"YearMonth": "2021-05-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 14}, {"YearMonth": "2021-06-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 39}, {"YearMonth": "2021-06-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 19}, {"YearMonth": "2021-07-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 37}, {"YearMonth": "2021-07-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 19}, {"YearMonth": "2021-08-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 36}, {"YearMonth": "2021-08-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 9}, {"YearMonth": "2021-09-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 47}, {"YearMonth": "2021-09-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 11}, {"YearMonth": "2021-10-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 32}, {"YearMonth": "2021-10-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 11}, {"YearMonth": "2021-11-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 44}, {"YearMonth": "2021-11-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 12}, {"YearMonth": "2021-12-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 35}, {"YearMonth": "2021-12-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 7}, {"YearMonth": "2022-01-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 20}, {"YearMonth": "2022-01-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 8}, {"YearMonth": "2022-02-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 27}, {"YearMonth": "2022-02-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 17}, {"YearMonth": "2022-03-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 35}, {"YearMonth": "2022-03-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 21}, {"YearMonth": "2022-04-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 26}, {"YearMonth": "2022-04-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 19}, {"YearMonth": "2022-05-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 31}, {"YearMonth": "2022-05-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 17}, {"YearMonth": "2022-06-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 41}, {"YearMonth": "2022-06-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 27}, {"YearMonth": "2022-07-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 34}, {"YearMonth": "2022-07-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 13}, {"YearMonth": "2022-08-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 36}, {"YearMonth": "2022-08-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 15}, {"YearMonth": "2022-09-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 38}, {"YearMonth": "2022-09-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 20}, {"YearMonth": "2022-10-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 34}, {"YearMonth": "2022-10-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 12}, {"YearMonth": "2022-11-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 32}, {"YearMonth": "2022-11-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 18}, {"YearMonth": "2022-12-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 23}, {"YearMonth": "2022-12-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 20}, {"YearMonth": "2023-01-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 30}, {"YearMonth": "2023-01-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 15}, {"YearMonth": "2023-02-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 24}, {"YearMonth": "2023-02-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 22}, {"YearMonth": "2023-03-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 45}, {"YearMonth": "2023-03-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 18}, {"YearMonth": "2023-04-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 44}, {"YearMonth": "2023-04-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 18}, {"YearMonth": "2023-05-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 51}, {"YearMonth": "2023-05-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 16}, {"YearMonth": "2023-06-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 45}, {"YearMonth": "2023-06-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 18}, {"YearMonth": "2023-07-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 23}, {"YearMonth": "2023-07-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 13}, {"YearMonth": "2023-08-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 41}, {"YearMonth": "2023-08-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 20}, {"YearMonth": "2023-09-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 45}, {"YearMonth": "2023-09-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 13}, {"YearMonth": "2023-10-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 42}, {"YearMonth": "2023-10-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 12}, {"YearMonth": "2023-11-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 33}, {"YearMonth": "2023-11-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 17}, {"YearMonth": "2023-12-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 38}, {"YearMonth": "2023-12-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 12}, {"YearMonth": "2024-01-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 37}, {"YearMonth": "2024-01-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 8}, {"YearMonth": "2024-02-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 27}, {"YearMonth": "2024-02-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 15}, {"YearMonth": "2024-03-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 35}, {"YearMonth": "2024-03-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 13}, {"YearMonth": "2024-04-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 33}, {"YearMonth": "2024-04-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 12}, {"YearMonth": "2024-05-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 46}, {"YearMonth": "2024-05-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 13}, {"YearMonth": "2024-06-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 51}, {"YearMonth": "2024-06-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 14}, {"YearMonth": "2024-07-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 48}, {"YearMonth": "2024-07-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 16}, {"YearMonth": "2024-08-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 31}, {"YearMonth": "2024-08-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 14}, {"YearMonth": "2024-09-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 44}, {"YearMonth": "2024-09-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 13}, {"YearMonth": "2024-10-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 42}, {"YearMonth": "2024-10-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 16}, {"YearMonth": "2024-11-01T00:00:00", "Category": "Criminal and Civil Actions", "Enforcement_Actions": 13}, {"YearMonth": "2024-11-01T00:00:00", "Category": "State Enforcement Agencies", "Enforcement_Actions": 3}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<ul>
<li>based on five topics</li>
</ul>
<div id="7faed0c0" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load your data from the CSV file created in Step 2 (replace with actual file path if needed)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"enforcement_actions_2021_1.csv"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Date to datetime format and extract month-year for aggregation</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'YearMonth'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to categorize topics</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_topic(title):</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> title.lower()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(keyword <span class="kw">in</span> title <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">"medicare"</span>, <span class="st">"medicaid"</span>, <span class="st">"hospital"</span>, <span class="st">"pharmacy"</span>, <span class="st">"doctor"</span>]):</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Health Care Fraud"</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> title <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">"bank"</span>, <span class="st">"financial"</span>, <span class="st">"investment"</span>, <span class="st">"money laundering"</span>]):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Financial Fraud"</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> title <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">"drug"</span>, <span class="st">"narcotics"</span>, <span class="st">"opioid"</span>, <span class="st">"prescription"</span>]):</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Drug Enforcement"</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">any</span>(keyword <span class="kw">in</span> title <span class="cf">for</span> keyword <span class="kw">in</span> [<span class="st">"bribery"</span>, <span class="st">"corruption"</span>, <span class="st">"kickback"</span>]):</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Bribery/Corruption"</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Other"</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply categorization to each title</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Topic'</span>] <span class="op">=</span> df[<span class="st">'Title'</span>].<span class="bu">apply</span>(categorize_topic)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by YearMonth and Topic, then count occurrences</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>monthly_topic_counts <span class="op">=</span> df.groupby([<span class="st">'YearMonth'</span>, <span class="st">'Topic'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert YearMonth back to datetime for Altair compatibility</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>monthly_topic_counts[<span class="st">'YearMonth'</span>] <span class="op">=</span> monthly_topic_counts[<span class="st">'YearMonth'</span>].dt.to_timestamp()</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the line chart with Altair</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(monthly_topic_counts).mark_line().encode(</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'YearMonth:T'</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Count:Q'</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'Topic:N'</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Number of Enforcement Actions by Topic Over Time"</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">400</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>chart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<style>
  #altair-viz-9fae75cec868461cbb99a8618d08a072.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9fae75cec868461cbb99a8618d08a072.vega-embed details,
  #altair-viz-9fae75cec868461cbb99a8618d08a072.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9fae75cec868461cbb99a8618d08a072"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9fae75cec868461cbb99a8618d08a072") {
      outputDiv = document.getElementById("altair-viz-9fae75cec868461cbb99a8618d08a072");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-3a750d773f2ab24151051cb41f741c9c"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "Topic", "type": "nominal"}, "x": {"field": "YearMonth", "type": "temporal"}, "y": {"field": "Count", "type": "quantitative"}}, "height": 400, "title": "Number of Enforcement Actions by Topic Over Time", "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-3a750d773f2ab24151051cb41f741c9c": [{"YearMonth": "2021-01-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2021-01-01T00:00:00", "Topic": "Drug Enforcement", "Count": 3}, {"YearMonth": "2021-01-01T00:00:00", "Topic": "Health Care Fraud", "Count": 15}, {"YearMonth": "2021-01-01T00:00:00", "Topic": "Other", "Count": 19}, {"YearMonth": "2021-02-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2021-02-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2021-02-01T00:00:00", "Topic": "Financial Fraud", "Count": 3}, {"YearMonth": "2021-02-01T00:00:00", "Topic": "Health Care Fraud", "Count": 16}, {"YearMonth": "2021-02-01T00:00:00", "Topic": "Other", "Count": 31}, {"YearMonth": "2021-03-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2021-03-01T00:00:00", "Topic": "Drug Enforcement", "Count": 6}, {"YearMonth": "2021-03-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2021-03-01T00:00:00", "Topic": "Health Care Fraud", "Count": 13}, {"YearMonth": "2021-03-01T00:00:00", "Topic": "Other", "Count": 30}, {"YearMonth": "2021-04-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2021-04-01T00:00:00", "Topic": "Drug Enforcement", "Count": 5}, {"YearMonth": "2021-04-01T00:00:00", "Topic": "Health Care Fraud", "Count": 18}, {"YearMonth": "2021-04-01T00:00:00", "Topic": "Other", "Count": 46}, {"YearMonth": "2021-05-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2021-05-01T00:00:00", "Topic": "Drug Enforcement", "Count": 7}, {"YearMonth": "2021-05-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2021-05-01T00:00:00", "Topic": "Health Care Fraud", "Count": 24}, {"YearMonth": "2021-05-01T00:00:00", "Topic": "Other", "Count": 28}, {"YearMonth": "2021-06-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2021-06-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2021-06-01T00:00:00", "Topic": "Financial Fraud", "Count": 3}, {"YearMonth": "2021-06-01T00:00:00", "Topic": "Health Care Fraud", "Count": 22}, {"YearMonth": "2021-06-01T00:00:00", "Topic": "Other", "Count": 36}, {"YearMonth": "2021-07-01T00:00:00", "Topic": "Drug Enforcement", "Count": 8}, {"YearMonth": "2021-07-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2021-07-01T00:00:00", "Topic": "Health Care Fraud", "Count": 20}, {"YearMonth": "2021-07-01T00:00:00", "Topic": "Other", "Count": 33}, {"YearMonth": "2021-08-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2021-08-01T00:00:00", "Topic": "Drug Enforcement", "Count": 3}, {"YearMonth": "2021-08-01T00:00:00", "Topic": "Health Care Fraud", "Count": 17}, {"YearMonth": "2021-08-01T00:00:00", "Topic": "Other", "Count": 39}, {"YearMonth": "2021-09-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 6}, {"YearMonth": "2021-09-01T00:00:00", "Topic": "Drug Enforcement", "Count": 6}, {"YearMonth": "2021-09-01T00:00:00", "Topic": "Health Care Fraud", "Count": 23}, {"YearMonth": "2021-09-01T00:00:00", "Topic": "Other", "Count": 46}, {"YearMonth": "2021-10-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2021-10-01T00:00:00", "Topic": "Drug Enforcement", "Count": 6}, {"YearMonth": "2021-10-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2021-10-01T00:00:00", "Topic": "Health Care Fraud", "Count": 16}, {"YearMonth": "2021-10-01T00:00:00", "Topic": "Other", "Count": 34}, {"YearMonth": "2021-11-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 8}, {"YearMonth": "2021-11-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2021-11-01T00:00:00", "Topic": "Health Care Fraud", "Count": 24}, {"YearMonth": "2021-11-01T00:00:00", "Topic": "Other", "Count": 34}, {"YearMonth": "2021-12-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2021-12-01T00:00:00", "Topic": "Drug Enforcement", "Count": 5}, {"YearMonth": "2021-12-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2021-12-01T00:00:00", "Topic": "Health Care Fraud", "Count": 12}, {"YearMonth": "2021-12-01T00:00:00", "Topic": "Other", "Count": 39}, {"YearMonth": "2022-01-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2022-01-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2022-01-01T00:00:00", "Topic": "Health Care Fraud", "Count": 11}, {"YearMonth": "2022-01-01T00:00:00", "Topic": "Other", "Count": 29}, {"YearMonth": "2022-02-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2022-02-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2022-02-01T00:00:00", "Topic": "Financial Fraud", "Count": 4}, {"YearMonth": "2022-02-01T00:00:00", "Topic": "Health Care Fraud", "Count": 25}, {"YearMonth": "2022-02-01T00:00:00", "Topic": "Other", "Count": 20}, {"YearMonth": "2022-03-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2022-03-01T00:00:00", "Topic": "Drug Enforcement", "Count": 7}, {"YearMonth": "2022-03-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2022-03-01T00:00:00", "Topic": "Health Care Fraud", "Count": 22}, {"YearMonth": "2022-03-01T00:00:00", "Topic": "Other", "Count": 39}, {"YearMonth": "2022-04-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2022-04-01T00:00:00", "Topic": "Drug Enforcement", "Count": 5}, {"YearMonth": "2022-04-01T00:00:00", "Topic": "Health Care Fraud", "Count": 23}, {"YearMonth": "2022-04-01T00:00:00", "Topic": "Other", "Count": 28}, {"YearMonth": "2022-05-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2022-05-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2022-05-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2022-05-01T00:00:00", "Topic": "Health Care Fraud", "Count": 19}, {"YearMonth": "2022-05-01T00:00:00", "Topic": "Other", "Count": 34}, {"YearMonth": "2022-06-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2022-06-01T00:00:00", "Topic": "Drug Enforcement", "Count": 6}, {"YearMonth": "2022-06-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2022-06-01T00:00:00", "Topic": "Health Care Fraud", "Count": 33}, {"YearMonth": "2022-06-01T00:00:00", "Topic": "Other", "Count": 45}, {"YearMonth": "2022-07-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 5}, {"YearMonth": "2022-07-01T00:00:00", "Topic": "Drug Enforcement", "Count": 7}, {"YearMonth": "2022-07-01T00:00:00", "Topic": "Health Care Fraud", "Count": 16}, {"YearMonth": "2022-07-01T00:00:00", "Topic": "Other", "Count": 33}, {"YearMonth": "2022-08-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2022-08-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2022-08-01T00:00:00", "Topic": "Financial Fraud", "Count": 3}, {"YearMonth": "2022-08-01T00:00:00", "Topic": "Health Care Fraud", "Count": 26}, {"YearMonth": "2022-08-01T00:00:00", "Topic": "Other", "Count": 38}, {"YearMonth": "2022-09-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2022-09-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2022-09-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2022-09-01T00:00:00", "Topic": "Health Care Fraud", "Count": 27}, {"YearMonth": "2022-09-01T00:00:00", "Topic": "Other", "Count": 35}, {"YearMonth": "2022-10-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2022-10-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2022-10-01T00:00:00", "Topic": "Financial Fraud", "Count": 2}, {"YearMonth": "2022-10-01T00:00:00", "Topic": "Health Care Fraud", "Count": 16}, {"YearMonth": "2022-10-01T00:00:00", "Topic": "Other", "Count": 28}, {"YearMonth": "2022-11-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2022-11-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2022-11-01T00:00:00", "Topic": "Health Care Fraud", "Count": 27}, {"YearMonth": "2022-11-01T00:00:00", "Topic": "Other", "Count": 31}, {"YearMonth": "2022-12-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2022-12-01T00:00:00", "Topic": "Drug Enforcement", "Count": 1}, {"YearMonth": "2022-12-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2022-12-01T00:00:00", "Topic": "Health Care Fraud", "Count": 15}, {"YearMonth": "2022-12-01T00:00:00", "Topic": "Other", "Count": 37}, {"YearMonth": "2023-01-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 5}, {"YearMonth": "2023-01-01T00:00:00", "Topic": "Drug Enforcement", "Count": 1}, {"YearMonth": "2023-01-01T00:00:00", "Topic": "Health Care Fraud", "Count": 17}, {"YearMonth": "2023-01-01T00:00:00", "Topic": "Other", "Count": 33}, {"YearMonth": "2023-02-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2023-02-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2023-02-01T00:00:00", "Topic": "Health Care Fraud", "Count": 14}, {"YearMonth": "2023-02-01T00:00:00", "Topic": "Other", "Count": 45}, {"YearMonth": "2023-03-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 6}, {"YearMonth": "2023-03-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2023-03-01T00:00:00", "Topic": "Financial Fraud", "Count": 3}, {"YearMonth": "2023-03-01T00:00:00", "Topic": "Health Care Fraud", "Count": 26}, {"YearMonth": "2023-03-01T00:00:00", "Topic": "Other", "Count": 38}, {"YearMonth": "2023-04-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2023-04-01T00:00:00", "Topic": "Drug Enforcement", "Count": 5}, {"YearMonth": "2023-04-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2023-04-01T00:00:00", "Topic": "Health Care Fraud", "Count": 31}, {"YearMonth": "2023-04-01T00:00:00", "Topic": "Other", "Count": 39}, {"YearMonth": "2023-05-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2023-05-01T00:00:00", "Topic": "Drug Enforcement", "Count": 3}, {"YearMonth": "2023-05-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2023-05-01T00:00:00", "Topic": "Health Care Fraud", "Count": 30}, {"YearMonth": "2023-05-01T00:00:00", "Topic": "Other", "Count": 43}, {"YearMonth": "2023-06-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2023-06-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2023-06-01T00:00:00", "Topic": "Financial Fraud", "Count": 3}, {"YearMonth": "2023-06-01T00:00:00", "Topic": "Health Care Fraud", "Count": 28}, {"YearMonth": "2023-06-01T00:00:00", "Topic": "Other", "Count": 53}, {"YearMonth": "2023-07-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2023-07-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2023-07-01T00:00:00", "Topic": "Financial Fraud", "Count": 2}, {"YearMonth": "2023-07-01T00:00:00", "Topic": "Health Care Fraud", "Count": 18}, {"YearMonth": "2023-07-01T00:00:00", "Topic": "Other", "Count": 27}, {"YearMonth": "2023-08-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2023-08-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2023-08-01T00:00:00", "Topic": "Health Care Fraud", "Count": 36}, {"YearMonth": "2023-08-01T00:00:00", "Topic": "Other", "Count": 39}, {"YearMonth": "2023-09-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 8}, {"YearMonth": "2023-09-01T00:00:00", "Topic": "Drug Enforcement", "Count": 5}, {"YearMonth": "2023-09-01T00:00:00", "Topic": "Financial Fraud", "Count": 2}, {"YearMonth": "2023-09-01T00:00:00", "Topic": "Health Care Fraud", "Count": 19}, {"YearMonth": "2023-09-01T00:00:00", "Topic": "Other", "Count": 35}, {"YearMonth": "2023-10-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 6}, {"YearMonth": "2023-10-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2023-10-01T00:00:00", "Topic": "Financial Fraud", "Count": 2}, {"YearMonth": "2023-10-01T00:00:00", "Topic": "Health Care Fraud", "Count": 25}, {"YearMonth": "2023-10-01T00:00:00", "Topic": "Other", "Count": 37}, {"YearMonth": "2023-11-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 5}, {"YearMonth": "2023-11-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2023-11-01T00:00:00", "Topic": "Health Care Fraud", "Count": 22}, {"YearMonth": "2023-11-01T00:00:00", "Topic": "Other", "Count": 31}, {"YearMonth": "2023-12-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 6}, {"YearMonth": "2023-12-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2023-12-01T00:00:00", "Topic": "Health Care Fraud", "Count": 18}, {"YearMonth": "2023-12-01T00:00:00", "Topic": "Other", "Count": 38}, {"YearMonth": "2024-01-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 1}, {"YearMonth": "2024-01-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2024-01-01T00:00:00", "Topic": "Financial Fraud", "Count": 2}, {"YearMonth": "2024-01-01T00:00:00", "Topic": "Health Care Fraud", "Count": 22}, {"YearMonth": "2024-01-01T00:00:00", "Topic": "Other", "Count": 35}, {"YearMonth": "2024-02-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 6}, {"YearMonth": "2024-02-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2024-02-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2024-02-01T00:00:00", "Topic": "Health Care Fraud", "Count": 22}, {"YearMonth": "2024-02-01T00:00:00", "Topic": "Other", "Count": 25}, {"YearMonth": "2024-03-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2024-03-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2024-03-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2024-03-01T00:00:00", "Topic": "Health Care Fraud", "Count": 24}, {"YearMonth": "2024-03-01T00:00:00", "Topic": "Other", "Count": 28}, {"YearMonth": "2024-04-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2024-04-01T00:00:00", "Topic": "Drug Enforcement", "Count": 4}, {"YearMonth": "2024-04-01T00:00:00", "Topic": "Financial Fraud", "Count": 2}, {"YearMonth": "2024-04-01T00:00:00", "Topic": "Health Care Fraud", "Count": 20}, {"YearMonth": "2024-04-01T00:00:00", "Topic": "Other", "Count": 29}, {"YearMonth": "2024-05-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 5}, {"YearMonth": "2024-05-01T00:00:00", "Topic": "Drug Enforcement", "Count": 5}, {"YearMonth": "2024-05-01T00:00:00", "Topic": "Health Care Fraud", "Count": 27}, {"YearMonth": "2024-05-01T00:00:00", "Topic": "Other", "Count": 39}, {"YearMonth": "2024-06-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2024-06-01T00:00:00", "Topic": "Drug Enforcement", "Count": 2}, {"YearMonth": "2024-06-01T00:00:00", "Topic": "Health Care Fraud", "Count": 21}, {"YearMonth": "2024-06-01T00:00:00", "Topic": "Other", "Count": 58}, {"YearMonth": "2024-07-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 4}, {"YearMonth": "2024-07-01T00:00:00", "Topic": "Drug Enforcement", "Count": 3}, {"YearMonth": "2024-07-01T00:00:00", "Topic": "Health Care Fraud", "Count": 20}, {"YearMonth": "2024-07-01T00:00:00", "Topic": "Other", "Count": 42}, {"YearMonth": "2024-08-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 3}, {"YearMonth": "2024-08-01T00:00:00", "Topic": "Drug Enforcement", "Count": 3}, {"YearMonth": "2024-08-01T00:00:00", "Topic": "Health Care Fraud", "Count": 17}, {"YearMonth": "2024-08-01T00:00:00", "Topic": "Other", "Count": 33}, {"YearMonth": "2024-09-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 5}, {"YearMonth": "2024-09-01T00:00:00", "Topic": "Drug Enforcement", "Count": 8}, {"YearMonth": "2024-09-01T00:00:00", "Topic": "Health Care Fraud", "Count": 27}, {"YearMonth": "2024-09-01T00:00:00", "Topic": "Other", "Count": 31}, {"YearMonth": "2024-10-01T00:00:00", "Topic": "Bribery/Corruption", "Count": 2}, {"YearMonth": "2024-10-01T00:00:00", "Topic": "Drug Enforcement", "Count": 9}, {"YearMonth": "2024-10-01T00:00:00", "Topic": "Financial Fraud", "Count": 1}, {"YearMonth": "2024-10-01T00:00:00", "Topic": "Health Care Fraud", "Count": 24}, {"YearMonth": "2024-10-01T00:00:00", "Topic": "Other", "Count": 46}, {"YearMonth": "2024-11-01T00:00:00", "Topic": "Drug Enforcement", "Count": 1}, {"YearMonth": "2024-11-01T00:00:00", "Topic": "Health Care Fraud", "Count": 9}, {"YearMonth": "2024-11-01T00:00:00", "Topic": "Other", "Count": 6}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
</section>
<section id="step-4-create-maps-of-enforcement-activity" class="level2">
<h2 class="anchored" data-anchor-id="step-4-create-maps-of-enforcement-activity">Step 4: Create maps of enforcement activity</h2>
<section id="map-by-state-partner-1" class="level3">
<h3 class="anchored" data-anchor-id="map-by-state-partner-1">1. Map by State (PARTNER 1)</h3>
<div id="79c38a1f" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define paths</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>state_shapefile_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/cb_2018_us_state_500k/cb_2018_us_state_500k.shp"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>csv_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/enforcement_actions_2023_1_cleaned.csv"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the state shapefile and enforcement actions data</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>states_gdf <span class="op">=</span> gpd.read_file(state_shapefile_path)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>actions_df <span class="op">=</span> pd.read_csv(csv_path)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and clean state names from the 'Agency' column</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_state(agency_name):</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r"State of ([A-Za-z\s]+)"</span>, agency_name)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> match.group(<span class="dv">1</span>).strip() <span class="cf">if</span> match <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>actions_df[<span class="st">'State'</span>] <span class="op">=</span> actions_df[<span class="st">'Agency'</span>].<span class="bu">apply</span>(extract_state)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Group actions by state</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>state_actions <span class="op">=</span> actions_df.dropna(subset<span class="op">=</span>[<span class="st">'State'</span>]).groupby(<span class="st">'State'</span>).size().reset_index(name<span class="op">=</span><span class="st">'ActionCount'</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename and merge to ensure compatibility</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>states_gdf <span class="op">=</span> states_gdf.rename(columns<span class="op">=</span>{<span class="st">"NAME"</span>: <span class="st">"State"</span>})</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>merged_gdf <span class="op">=</span> states_gdf.merge(state_actions, on<span class="op">=</span><span class="st">"State"</span>, how<span class="op">=</span><span class="st">"left"</span>).fillna({<span class="st">'ActionCount'</span>: <span class="dv">0</span>})</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the choropleth map</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>merged_gdf.plot(column<span class="op">=</span><span class="st">"ActionCount"</span>, cmap<span class="op">=</span><span class="st">"OrRd"</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"0.8"</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize map appearance</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"State-Level Enforcement Actions by State (Mainland U.S.)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">65</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">25</span>, <span class="dv">50</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Label states with higher action counts</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, label, count <span class="kw">in</span> <span class="bu">zip</span>(merged_gdf.geometry.centroid.x, merged_gdf.geometry.centroid.y, merged_gdf[<span class="st">"State"</span>], merged_gdf[<span class="st">"ActionCount"</span>]):</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        ax.text(x, y, label, fontsize<span class="op">=</span><span class="dv">8</span>, ha<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps5_template%20(1)_files/figure-html/cell-10-output-1.png" width="708" height="624" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="map-by-district-partner-2" class="level3">
<h3 class="anchored" data-anchor-id="map-by-district-partner-2">2. Map by District (PARTNER 2)</h3>
<div id="cad0e122" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> inset_axes</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Updated path to the shapefile and CSV data</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>shapefile_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/US Attorney Districts Shapefile simplified_20241108/geo_export_695e4db7-129b-4351-bfc9-31ef5c1e3499.shp"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>csv_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/enforcement_actions_2023_1_cleaned.csv"</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the shapefile and CSV data</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> gpd.read_file(shapefile_path)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>actions_df <span class="op">=</span> pd.read_csv(csv_path)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and clean district names in the 'Agency' column in actions_df</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_district(agency_name):</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r"(District of [A-Za-z\s]+|[A-Za-z]+ District of [A-Za-z\s]+)"</span>, agency_name)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match:</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> match.group(<span class="dv">0</span>).strip()</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>actions_df[<span class="st">'District'</span>] <span class="op">=</span> actions_df[<span class="st">'Agency'</span>].<span class="bu">apply</span>(extract_district)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>district_actions <span class="op">=</span> actions_df.dropna(subset<span class="op">=</span>[<span class="st">'District'</span>]).groupby(<span class="st">'District'</span>).size().reset_index(name<span class="op">=</span><span class="st">'ActionCount'</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename judicial_d to District in districts_gdf for merging</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> districts_gdf.rename(columns<span class="op">=</span>{<span class="st">"judicial_d"</span>: <span class="st">"District"</span>})</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the data</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>merged_gdf <span class="op">=</span> districts_gdf.merge(district_actions, on<span class="op">=</span><span class="st">"District"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>merged_gdf[<span class="st">"ActionCount"</span>] <span class="op">=</span> merged_gdf[<span class="st">"ActionCount"</span>].fillna(<span class="dv">0</span>)  <span class="co"># Fill missing values with 0</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Main map plot</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>merged_gdf.plot(column<span class="op">=</span><span class="st">"ActionCount"</span>, cmap<span class="op">=</span><span class="st">"OrRd"</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"0.8"</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and labels</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"U.S. Attorney District-Level Enforcement Actions"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plot limits to zoom in on mainland U.S.</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">65</span>)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">25</span>, <span class="dv">50</span>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Define boundaries for the Northeast region for inset</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>northeast_long <span class="op">=</span> <span class="op">-</span><span class="dv">80</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>northeast_lat <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels with a different threshold for the Northeast</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, label, count <span class="kw">in</span> <span class="bu">zip</span>(merged_gdf.geometry.centroid.x, merged_gdf.geometry.centroid.y, merged_gdf[<span class="st">"District"</span>], merged_gdf[<span class="st">"ActionCount"</span>]):</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Relaxed threshold for the main map, only high-action districts in the Northeast</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">20</span>:</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">&gt;</span> northeast_long <span class="kw">and</span> y <span class="op">&gt;</span> northeast_lat:</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>  <span class="co"># Skip labeling Northeast in main map</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>            ax.text(x, y, label, fontsize<span class="op">=</span><span class="dv">6</span>, ha<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an inset map for the Northeast</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>inset_ax <span class="op">=</span> inset_axes(ax, width<span class="op">=</span><span class="st">"30%"</span>, height<span class="op">=</span><span class="st">"30%"</span>, loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>merged_gdf.plot(column<span class="op">=</span><span class="st">"ActionCount"</span>, cmap<span class="op">=</span><span class="st">"OrRd"</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>inset_ax, edgecolor<span class="op">=</span><span class="st">"0.8"</span>)</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust inset map view to focus on the Northeast</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>inset_ax.set_xlim(<span class="op">-</span><span class="dv">80</span>, <span class="op">-</span><span class="dv">65</span>)</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>inset_ax.set_ylim(<span class="dv">37</span>, <span class="dv">45</span>)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>inset_ax.axis(<span class="st">"off"</span>)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels for the inset map with a lower threshold for more detail</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, label, count <span class="kw">in</span> <span class="bu">zip</span>(merged_gdf.geometry.centroid.x, merged_gdf.geometry.centroid.y, merged_gdf[<span class="st">"District"</span>], merged_gdf[<span class="st">"ActionCount"</span>]):</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">-</span><span class="dv">80</span> <span class="op">&lt;</span> x <span class="op">&lt;</span> <span class="op">-</span><span class="dv">65</span> <span class="kw">and</span> <span class="dv">37</span> <span class="op">&lt;</span> y <span class="op">&lt;</span> <span class="dv">45</span> <span class="kw">and</span> count <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>        inset_ax.text(x, y, label, fontsize<span class="op">=</span><span class="dv">5</span>, ha<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps5_template%20(1)_files/figure-html/cell-11-output-1.png" width="707" height="619" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="extra-credit" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit">Extra Credit</h2>
<section id="merge-zip-code-shapefile-with-population" class="level3">
<h3 class="anchored" data-anchor-id="merge-zip-code-shapefile-with-population">1. Merge zip code shapefile with population</h3>
<div id="56761ffb" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> inset_axes</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Paths to files</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>districts_shapefile_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/US Attorney Districts Shapefile simplified_20241108/geo_export_695e4db7-129b-4351-bfc9-31ef5c1e3499.shp"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>enforcement_data_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/enforcement_actions_2023_1_cleaned.csv"</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>population_data_path <span class="op">=</span> <span class="st">"/Users/attaullah/Documents/PS5/DECENNIALDHC2020.P1-Data.csv"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the shapefile and enforcement actions data</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> gpd.read_file(districts_shapefile_path)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>enforcement_df <span class="op">=</span> pd.read_csv(enforcement_data_path)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>population_df <span class="op">=</span> pd.read_csv(population_data_path)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and extract zip codes in population data</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>population_df[<span class="st">'ZIP'</span>] <span class="op">=</span> population_df[<span class="st">'NAME'</span>].<span class="bu">str</span>.extract(<span class="vs">r'(\d</span><span class="sc">{5}</span><span class="vs">)'</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>population_df <span class="op">=</span> population_df[[<span class="st">'ZIP'</span>, <span class="st">'P1_001N'</span>]].rename(columns<span class="op">=</span>{<span class="st">'P1_001N'</span>: <span class="st">'Population'</span>})</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean 'Agency' field in enforcement data to extract district names</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_district(agency_name):</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r"(District of [A-Za-z\s]+|[A-Za-z]+ District of [A-Za-z\s]+)"</span>, agency_name)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> match.group(<span class="dv">0</span>).strip() <span class="cf">if</span> match <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>enforcement_df[<span class="st">'District'</span>] <span class="op">=</span> enforcement_df[<span class="st">'Agency'</span>].<span class="bu">apply</span>(extract_district)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate per-capita actions by district</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>district_actions <span class="op">=</span> enforcement_df.groupby(<span class="st">'District'</span>).size().reset_index(name<span class="op">=</span><span class="st">'ActionCount'</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>population_by_district <span class="op">=</span> population_df.groupby(<span class="st">'ZIP'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge data</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>merged_gdf <span class="op">=</span> districts_gdf.merge(district_actions, left_on<span class="op">=</span><span class="st">'judicial_d'</span>, right_on<span class="op">=</span><span class="st">'District'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna({<span class="st">'ActionCount'</span>: <span class="dv">0</span>})</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>merged_gdf <span class="op">=</span> merged_gdf.merge(population_by_district, left_on<span class="op">=</span><span class="st">'district_n'</span>, right_on<span class="op">=</span><span class="st">'ZIP'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing population values with 1 to avoid division by zero</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>merged_gdf[<span class="st">'Population'</span>] <span class="op">=</span> merged_gdf[<span class="st">'Population'</span>].fillna(<span class="dv">1</span>)  <span class="co"># To avoid NaNs or division by zero</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate actions per capita</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>merged_gdf[<span class="st">'Actions_Per_Capita'</span>] <span class="op">=</span> merged_gdf[<span class="st">'ActionCount'</span>] <span class="op">/</span> merged_gdf[<span class="st">'Population'</span>]</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Main map plot</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>merged_gdf.plot(column<span class="op">=</span><span class="st">"Actions_Per_Capita"</span>, cmap<span class="op">=</span><span class="st">"OrRd"</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"0.8"</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize map appearance</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"U.S. Attorney District-Level Enforcement Actions Per Capita"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">65</span>)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">25</span>, <span class="dv">50</span>)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the boundaries for the Northeast region</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>northeast_long <span class="op">=</span> <span class="op">-</span><span class="dv">80</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>northeast_lat <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels with a different threshold for the Northeast</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, label, count <span class="kw">in</span> <span class="bu">zip</span>(merged_gdf.geometry.centroid.x, merged_gdf.geometry.centroid.y, merged_gdf[<span class="st">"District"</span>], merged_gdf[<span class="st">"Actions_Per_Capita"</span>]):</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;</span> northeast_long <span class="kw">and</span> y <span class="op">&gt;</span> northeast_lat:</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only show very high-count labels in the Northeast to avoid clutter</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">20</span>:  <span class="co"># Adjust threshold for Northeast labeling</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>            ax.text(x, y, label, fontsize<span class="op">=</span><span class="dv">5</span>, ha<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># More relaxed threshold for labels outside the Northeast</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">5</span>:  <span class="co"># General threshold for other areas</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>            ax.text(x, y, label, fontsize<span class="op">=</span><span class="dv">6</span>, ha<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an inset map for the Northeast</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>inset_ax <span class="op">=</span> inset_axes(ax, width<span class="op">=</span><span class="st">"30%"</span>, height<span class="op">=</span><span class="st">"30%"</span>, loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>merged_gdf.plot(column<span class="op">=</span><span class="st">"Actions_Per_Capita"</span>, cmap<span class="op">=</span><span class="st">"OrRd"</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>inset_ax, edgecolor<span class="op">=</span><span class="st">"0.8"</span>)</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust inset map view to focus on the Northeast</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>inset_ax.set_xlim(<span class="op">-</span><span class="dv">80</span>, <span class="op">-</span><span class="dv">65</span>)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>inset_ax.set_ylim(<span class="dv">37</span>, <span class="dv">45</span>)</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>inset_ax.axis(<span class="st">"off"</span>)</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels for the inset map with a relaxed threshold</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, label, count <span class="kw">in</span> <span class="bu">zip</span>(merged_gdf.geometry.centroid.x, merged_gdf.geometry.centroid.y, merged_gdf[<span class="st">"District"</span>], merged_gdf[<span class="st">"Actions_Per_Capita"</span>]):</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">-</span><span class="dv">80</span> <span class="op">&lt;</span> x <span class="op">&lt;</span> <span class="op">-</span><span class="dv">65</span> <span class="kw">and</span> <span class="dv">37</span> <span class="op">&lt;</span> y <span class="op">&lt;</span> <span class="dv">45</span>:</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">5</span>:  <span class="co"># Lower threshold for the inset to show more details in the Northeast</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>            inset_ax.text(x, y, label, fontsize<span class="op">=</span><span class="dv">4</span>, ha<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps5_template%20(1)_files/figure-html/cell-12-output-1.png" width="726" height="619" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conduct-spatial-join" class="level3">
<h3 class="anchored" data-anchor-id="conduct-spatial-join">2. Conduct spatial join</h3>
</section>
<section id="map-the-action-ratio-in-each-district" class="level3">
<h3 class="anchored" data-anchor-id="map-the-action-ratio-in-each-district">3. Map the action ratio in each district</h3>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>